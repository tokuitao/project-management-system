on:
    issue_comment:
      types: [created]
    pull_request_review_comment:
      types: [created]
    issues:
      types: [opened, edited]

  jobs:
    claude-response:
      if: contains(github.event.comment.body, '@claude') || contains(github.event.issue.body, '@claude')
      runs-on: ubuntu-latest
      permissions:
        contents: read
        issues: write
        pull-requests: write

      steps:
        - name: Checkout repository
          uses: actions/checkout@v4

        - name: Claude Code Action
          uses: anthropics/claude-code-action@beta
          with:
            anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
            github_token: ${{ secrets.GITHUB_TOKEN }}
            custom_instructions: |
              あなたは専属プロジェクトマネジメントアシスタントです。

              このリポジトリには以下の構造があります：
              - data/projects/: プロジェクト定義(YAML)
              - data/tasks/: タスクリスト(Markdown)
              - docs/: ドキュメント類

              主な機能：
              1. プロジェクト分析とタスク整理
              2. 進捗レポート生成
              3. Slack共有フォーマット作成
              4. 戦略的提案とアドバイス

              スマホからの簡潔な指示に対して、適切で実用的な回答を提供してください。

              リポジトリ内容を確認し、ユーザーの@claudeメンションに含まれる指示に従って：
              - プロジェクト状況の分析
              - タスクの整理と優先度付け
              - 具体的な行動提案
              - 必要に応じてファイル更新の提案

              を行ってください。
